<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì‘ Q&A í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ğŸ€„ï¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .api-links {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .api-links a {
            background: white;
            color: #667eea;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .api-links a:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 10px;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button.delete {
            background: #ef4444;
        }

        button.delete:hover {
            background: #dc2626;
        }

        button.update {
            background: #10b981;
        }

        button.update:hover {
            background: #059669;
        }

        .question-list {
            display: grid;
            gap: 15px;
        }

        .question-item {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            transition: all 0.3s;
        }

        .question-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateX(5px);
        }

        .question-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .question-title:hover {
            color: #667eea;
        }

        .question-meta {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 10px;
        }

        .question-content {
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 15px;
            display: none;
        }

        .question-content.show {
            display: block;
        }

        .answer-list {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
        }

        .answer-list.show {
            display: block;
        }

        .answer-item {
            padding: 12px;
            background: #f3f4f6;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .answer-meta {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 5px;
        }

        .answer-content {
            color: #374151;
            line-height: 1.5;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .pagination button {
            padding: 8px 16px;
        }

        .pagination span {
            font-weight: 600;
            color: #667eea;
        }

        .response {
            background: #f0fdf4;
            border: 1px solid #86efac;
            color: #166534;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            display: none;
        }

        .response.show {
            display: block;
        }

        .error {
            background: #fef2f2;
            border: 1px solid #fca5a5;
            color: #991b1b;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ€„ï¸ ë§ˆì‘ Q&A í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>

        <div class="api-links">
            <a href="/docs" target="_blank">ğŸ“– API ë¬¸ì„œ (Swagger)</a>
            <a href="/redoc" target="_blank">ğŸ“š API ë¬¸ì„œ (ReDoc)</a>
            <a href="/api" target="_blank">â„¹ï¸ API ì •ë³´</a>
        </div>

        <!-- ì§ˆë¬¸ ìƒì„± -->
        <div class="section">
            <h2>ğŸ“ ì§ˆë¬¸ ì‘ì„±</h2>
            <div class="form-group">
                <label>ì œëª© (5ì ì´ìƒ)</label>
                <input type="text" id="questionTitle" placeholder="ì§ˆë¬¸ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="form-group">
                <label>ë‚´ìš© (10ì ì´ìƒ)</label>
                <textarea id="questionContent" placeholder="ì§ˆë¬¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="form-group">
                <label>ì‘ì„±ì ë‹‰ë„¤ì„ (2ì ì´ìƒ)</label>
                <input type="text" id="questionAuthor" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <button onclick="createQuestion()">ì§ˆë¬¸ ë“±ë¡</button>
            <div id="createResponse" class="response"></div>
        </div>

        <!-- ì§ˆë¬¸ ëª©ë¡ -->
        <div class="section">
            <h2>ğŸ“‹ ì§ˆë¬¸ ëª©ë¡</h2>
            <div class="pagination">
                <button onclick="prevPage()">â† ì´ì „</button>
                <span>í˜ì´ì§€ <span id="currentPage">1</span></span>
                <button onclick="nextPage()">ë‹¤ìŒ â†’</button>
            </div>
            <div id="questionList" class="question-list"></div>
        </div>
    </div>

    <script>
        // í˜„ì¬ ë„ë©”ì¸ì„ API Base URLë¡œ ì‚¬ìš©
        const API_BASE_URL = window.location.origin;
        let currentPage = 1;
        const pageSize = 5;

        // ì§ˆë¬¸ ìƒì„±
        async function createQuestion() {
            const title = document.getElementById('questionTitle').value;
            const content = document.getElementById('questionContent').value;
            const author = document.getElementById('questionAuthor').value;

            try {
                const response = await fetch(`${API_BASE_URL}/questions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: title,
                        content: content,
                        author_nickname: author
                    })
                });

                const data = await response.json();
                const responseDiv = document.getElementById('createResponse');

                if (response.ok) {
                    responseDiv.className = 'response show';
                    responseDiv.textContent = `âœ… ì§ˆë¬¸ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! (ID: ${data.id})`;

                    // ì…ë ¥ ì´ˆê¸°í™”
                    document.getElementById('questionTitle').value = '';
                    document.getElementById('questionContent').value = '';
                    document.getElementById('questionAuthor').value = '';

                    // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    loadQuestions();
                } else {
                    responseDiv.className = 'response error show';
                    responseDiv.textContent = `âŒ ì˜¤ë¥˜: ${JSON.stringify(data.detail)}`;
                }
            } catch (error) {
                document.getElementById('createResponse').className = 'response error show';
                document.getElementById('createResponse').textContent = `âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`;
            }
        }

        // ì§ˆë¬¸ ëª©ë¡ ì¡°íšŒ
        async function loadQuestions() {
            try {
                const response = await fetch(`${API_BASE_URL}/questions?page=${currentPage}&size=${pageSize}`);
                const data = await response.json();

                const listDiv = document.getElementById('questionList');
                listDiv.innerHTML = '';

                if (data.items.length === 0) {
                    listDiv.innerHTML = '<p style="text-align: center; color: #9ca3af;">ë“±ë¡ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                data.items.forEach(question => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-item';
                    questionDiv.innerHTML = `
                        <div class="question-title" onclick="toggleQuestion(${question.id})">
                            ${question.title}
                        </div>
                        <div class="question-meta">
                            ì‘ì„±ì: ${question.author_nickname} | ID: ${question.id}
                        </div>
                        <div id="question-content-${question.id}" class="question-content"></div>
                        <div id="answers-${question.id}" class="answer-list"></div>
                        <div class="button-group">
                            <button onclick="loadAnswers(${question.id})">ë‹µë³€ ë³´ê¸°</button>
                            <button class="update" onclick="showUpdateForm(${question.id})">ìˆ˜ì •</button>
                            <button class="delete" onclick="deleteQuestion(${question.id})">ì‚­ì œ</button>
                        </div>
                    `;
                    listDiv.appendChild(questionDiv);
                });

                document.getElementById('currentPage').textContent = currentPage;
            } catch (error) {
                console.error('ì§ˆë¬¸ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error);
            }
        }

        // ì§ˆë¬¸ ìƒì„¸ í† ê¸€
        async function toggleQuestion(questionId) {
            const contentDiv = document.getElementById(`question-content-${questionId}`);

            if (contentDiv.classList.contains('show')) {
                contentDiv.classList.remove('show');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/questions/${questionId}`);
                const data = await response.json();

                contentDiv.innerHTML = `<p><strong>ë‚´ìš©:</strong> ${data.content}</p>`;
                contentDiv.classList.add('show');
            } catch (error) {
                console.error('ì§ˆë¬¸ ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨:', error);
            }
        }

        // ë‹µë³€ ëª©ë¡ ì¡°íšŒ
        async function loadAnswers(questionId) {
            const answersDiv = document.getElementById(`answers-${questionId}`);

            if (answersDiv.classList.contains('show')) {
                answersDiv.classList.remove('show');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/questions/${questionId}/answers`);
                const answers = await response.json();

                if (answers.length === 0) {
                    answersDiv.innerHTML = `
                        <p style="text-align: center; color: #9ca3af; margin: 10px 0;">
                            ì•„ì§ ë‹µë³€ì´ ì—†ìŠµë‹ˆë‹¤.
                        </p>
                        <div style="margin-top: 15px;">
                            <input type="text" id="answer-content-${questionId}"
                                   placeholder="ë‹µë³€ ë‚´ìš© (10ì ì´ìƒ)"
                                   style="width: 100%; margin-bottom: 10px;">
                            <input type="text" id="answer-author-${questionId}"
                                   placeholder="ì‘ì„±ì ë‹‰ë„¤ì„"
                                   style="width: 100%; margin-bottom: 10px;">
                            <button onclick="createAnswer(${questionId})">ë‹µë³€ ì‘ì„±</button>
                        </div>
                    `;
                } else {
                    answersDiv.innerHTML = answers.map(answer => `
                        <div class="answer-item">
                            <div class="answer-meta">
                                ${answer.author_nickname} | ID: ${answer.id}
                            </div>
                            <div class="answer-content">${answer.content}</div>
                            <div class="button-group" style="margin-top: 8px;">
                                <button class="delete" onclick="deleteAnswer(${questionId}, ${answer.id})">ì‚­ì œ</button>
                            </div>
                        </div>
                    `).join('') + `
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                            <input type="text" id="answer-content-${questionId}"
                                   placeholder="ë‹µë³€ ë‚´ìš© (10ì ì´ìƒ)"
                                   style="width: 100%; margin-bottom: 10px;">
                            <input type="text" id="answer-author-${questionId}"
                                   placeholder="ì‘ì„±ì ë‹‰ë„¤ì„"
                                   style="width: 100%; margin-bottom: 10px;">
                            <button onclick="createAnswer(${questionId})">ë‹µë³€ ì‘ì„±</button>
                        </div>
                    `;
                }

                answersDiv.classList.add('show');
            } catch (error) {
                console.error('ë‹µë³€ ì¡°íšŒ ì‹¤íŒ¨:', error);
            }
        }

        // ë‹µë³€ ì‘ì„±
        async function createAnswer(questionId) {
            const content = document.getElementById(`answer-content-${questionId}`).value;
            const author = document.getElementById(`answer-author-${questionId}`).value;

            try {
                const response = await fetch(`${API_BASE_URL}/questions/${questionId}/answers`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content: content,
                        author_nickname: author
                    })
                });

                if (response.ok) {
                    alert('âœ… ë‹µë³€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    document.getElementById(`answers-${questionId}`).classList.remove('show');
                    loadAnswers(questionId);
                } else {
                    const data = await response.json();
                    alert(`âŒ ì˜¤ë¥˜: ${JSON.stringify(data.detail)}`);
                }
            } catch (error) {
                alert(`âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        // ì§ˆë¬¸ ì‚­ì œ
        async function deleteQuestion(questionId) {
            if (!confirm('ì •ë§ ì´ ì§ˆë¬¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const response = await fetch(`${API_BASE_URL}/questions/${questionId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('âœ… ì§ˆë¬¸ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadQuestions();
                } else {
                    alert('âŒ ì‚­ì œ ì‹¤íŒ¨');
                }
            } catch (error) {
                alert(`âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        // ë‹µë³€ ì‚­ì œ
        async function deleteAnswer(questionId, answerId) {
            if (!confirm('ì •ë§ ì´ ë‹µë³€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const response = await fetch(`${API_BASE_URL}/questions/${questionId}/answers/${answerId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('âœ… ë‹µë³€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    document.getElementById(`answers-${questionId}`).classList.remove('show');
                    loadAnswers(questionId);
                } else {
                    alert('âŒ ì‚­ì œ ì‹¤íŒ¨');
                }
            } catch (error) {
                alert(`âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        // í˜ì´ì§€ë„¤ì´ì…˜
        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                loadQuestions();
            }
        }

        function nextPage() {
            currentPage++;
            loadQuestions();
        }

        // ì§ˆë¬¸ ìˆ˜ì • í¼ í‘œì‹œ
        function showUpdateForm(questionId) {
            const newTitle = prompt('ìƒˆë¡œìš´ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (ì·¨ì†Œí•˜ë©´ ì œëª© ìœ ì§€):');
            const newContent = prompt('ìƒˆë¡œìš´ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš” (ì·¨ì†Œí•˜ë©´ ë‚´ìš© ìœ ì§€):');

            const updateData = {};
            if (newTitle) updateData.title = newTitle;
            if (newContent) updateData.content = newContent;

            if (Object.keys(updateData).length === 0) {
                alert('ìˆ˜ì •í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            updateQuestion(questionId, updateData);
        }

        // ì§ˆë¬¸ ìˆ˜ì •
        async function updateQuestion(questionId, updateData) {
            try {
                const response = await fetch(`${API_BASE_URL}/questions/${questionId}`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updateData)
                });

                if (response.ok) {
                    alert('âœ… ì§ˆë¬¸ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadQuestions();
                } else {
                    const data = await response.json();
                    alert(`âŒ ì˜¤ë¥˜: ${JSON.stringify(data.detail)}`);
                }
            } catch (error) {
                alert(`âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì§ˆë¬¸ ëª©ë¡ ì¡°íšŒ
        window.onload = () => {
            loadQuestions();
        };
    </script>
</body>
</html>
